<odoo>
    <data>
        <template id="products_list" name="Service Desk Detail">
            <t t-call="website.layout">
                <div class="team_data">
                    <title>Products</title>
                    <div class="container">
                        <div class="accordion" id="accordionExample" style="width: 100%;">
                            <t t-foreach="products" t-as="product">
                                <div class="card">
                                    <div class="card-header d-flex justify-content-between"
                                         t-att-id="'headingOne_'  + str(product.id)">
                                        <div style="width:40%;">
                                            <h5 class="mb-0">
                                                <button class="btn btn-link collapsed" type="button"
                                                        data-toggle="collapse"
                                                        t-att-data-target="'#collapseOne_' + str(product.id)"
                                                        aria-expanded="true"
                                                        t-att-aria-controls="'collapseOne_' + str(product.id)">
                                                    <t t-esc="product.name"/>
                                                </button>
                                            </h5>
                                        </div>
                                        <div>
                                            <t t-esc="sum(product.stock_quant_ids.mapped('quantity'))"/>
                                        </div>
                                        <div>
                                            <button t-attf-href="#"
                                                    class="btn btn-primary float_right js_add_cart_json d-none d-md-inline-block"
                                                    aria-label="Add one" title="Add one" data-toggle="modal"
                                                    t-att-data-target="'#lotModal_' + str(product.id)">
                                                <i class="fa fa-plus"></i>
                                            </button>
                                        </div>
                                    </div>

                                    <div t-att-id="'collapseOne_' + str(product.id)" class="collapse"
                                         t-att-aria-labelledby="'headingOne_'  + str(product.id)"
                                         data-parent="#accordionExample">
                                        <div class="card-body">
                                            <table class="table table-sm table-bordered">
                                                <thead>
                                                    <tr>
                                                        <th t-if="product.tracking == 'lot'">Lot/Serial No.</th>
                                                        <th>Warehouse</th>
                                                        <th>Quantity</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <t t-foreach="product.stock_quant_ids" t-as="quant">
                                                        <tr>
                                                            <td t-if="product.tracking == 'lot'">
                                                                <t t-esc="quant.lot_id.name"/>
                                                            </td>
                                                            <td>
                                                                <t t-esc="quant.location_id.display_name"/>
                                                            </td>
                                                            <td>
                                                                <t t-esc="quant.quantity"/>
                                                            </td>
                                                        </tr>
                                                    </t>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- Modal -->
                                    <div class="modal fade" t-att-id="'lotModal_' + str(product.id)" tabindex="-1"
                                         role="dialog"
                                         aria-labelledby="exampleModalLabel" aria-hidden="true">
                                        <div class="modal-dialog" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="exampleModalLabel">
                                                        <t t-if="product.tracking == 'lot'">
                                                            Update Quantity with Lot/Serial Number
                                                        </t>
                                                        <t t-else="">
                                                            Update Quantity
                                                        </t>
                                                    </h5>
                                                    <button type="button" class="close" data-dismiss="modal"
                                                            aria-label="Close">
                                                        <span aria-hidden="true">&amp;times;</span>
                                                    </button>
                                                </div>
                                                <form method="post"
                                                      t-att-action="'/create/lot?product_id=' + str(product.id)">
                                                    <div class="modal-body">
                                                        <div class="form-group" t-if="product.tracking == 'lot'">
                                                            <label for="lot_id">Lot/Serial No.</label>
                                                            <input type="text" placeholder="Lot/Serial" name="lot_id"
                                                                   id="lot_id"
                                                                   class="form-control" required="required"/>
                                                        </div>

                                                        <div class="form-group">
                                                            <label for="warehouse_id">Warehouse</label>
                                                            <select class="form-control"
                                                                    name="warehouse_id" id="warehouse_id">
                                                                <option value="">Select Warehouse</option>
                                                                <t t-foreach="request.env['stock.location'].sudo().search([('usage', '=', 'internal')])"
                                                                   t-as="warehouse">
                                                                    <option t-att-value="warehouse.id"
                                                                            t-esc="warehouse.display_name"
                                                                            required="required"/>
                                                                </t>
                                                            </select>
                                                        </div>

                                                        <div class="form-group">
                                                            <label for="quantity">Quantity</label>
                                                            <input type="number" placeholder="Quantity"
                                                                   name="quantity" id="quantity" min="0"
                                                                   max="1000" step="0.1"
                                                                   t-attf-class="form-control" required="required"/>
                                                        </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary"
                                                                data-dismiss="modal">Close
                                                        </button>
                                                        <button type="submit" class="btn btn-primary">Save
                                                        </button>
                                                    </div>
                                                </form>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </t>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <t t-call="website.pager"/>
                            </div>
                        </div>
                    </div>
                </div>
            </t>
        </template>
    </data>
</odoo>